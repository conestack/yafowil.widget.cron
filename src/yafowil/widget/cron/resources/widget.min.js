var yafowil_cron=function(e,t){"use strict";let a={en:{select_minutes:"Select Minutes",select_hours:"Select Hours",select_dom:"Select Day of Month",select_month:"Select Month",select_dow:"Select Day of Week",select_year:"Select Year",select_all:"Select All",monthmap:{1:"January",2:"February",3:"March",4:"April",5:"May",6:"June",7:"July",8:"August",9:"September",10:"October",11:"November",12:"December"},dowmap:{1:"Monday",2:"Tuesday",3:"Wednesday",4:"Thursday",5:"Friday",6:"Saturday",0:"Sunday"},summary:"Summary",no_minutes_selected:"No minutes selected",selected_minutes:"Minutes: ",all_minutes_selected:"Every minute",no_hours_selected:"No hour selected",selected_hours:"Hours: ",all_hours_selected:"Every hour",no_dom_selected:"No day of month selected",selected_dom:"Days of month: ",all_dom_selected:"Every day of month",no_month_selected:"No month selected",selected_month:"Month: ",all_month_selected:"Every month",no_dow_selected:"No day of week selected",selected_dow:"Days of week: ",all_dow_selected:"Every day of week",no_year_selected:"No year selected",selected_years:"Years: ",all_years_selected:"Every year"},de:{select_minutes:"Minuten auswählen",select_hours:"Stunden auswählen",select_dom:"Monatstage auswählen",select_month:"Monate auswählen",select_dow:"Wochentage auswählen",select_year:"Jahre auswählen",select_all:"Alle auswählen",monthmap:{1:"Jänner",2:"Feber",3:"März",4:"April",5:"Mai",6:"Juni",7:"Juli",8:"August",9:"September",10:"Oktober",11:"November",12:"Dezember"},dowmap:{1:"Montag",2:"Dienstag",3:"Mittwoch",4:"Donnerstag",5:"Freitag",6:"Samstag",0:"Sonntag"},summary:"Zusammenfassung",no_minutes_selected:"Keine Minuten ausgewählt",selected_minutes:"Minuten: ",all_minutes_selected:"Jede Minute",no_hours_selected:"Keine Stunden ausgewählt",selected_hours:"Stunden: ",all_hours_selected:"Jede Stunde",no_dom_selected:"Keine Monatstage ausgewählt",selected_dom:"Monatstage: ",all_dom_selected:"Alle Monatstage",no_month_selected:"Keine Monate ausgewählt",selected_month:"Monate: ",all_month_selected:"Jedes Monat",no_dow_selected:"Keine Wochentage ausgewählt",selected_dow:"Wochentage: ",all_dow_selected:"Jeder Wochentag",no_year_selected:"Kein Jahr ausgewählt",selected_years:"Jahre: ",all_years_selected:"Jedes Jahr"}};class s{static initialize(e){t(".crontab.widget",e).each((function(){let e=t(this);void 0!==window.yafowil_array&&window.yafowil_array.inside_template(e)||new s(e,"edit")})),t(".display-crontab.widget",e).each((function(){let e=t(this);void 0!==window.yafowil_array&&window.yafowil_array.inside_template(e)||new s(e,"display")}))}constructor(e,a){e.data("yafowil-cron",this),this.root=e,this.mode=a;let s=e.data("lang");this.lang=s||"en";let n=e.data("start_year");this.start_year=n||(new Date).getFullYear();let i=e.data("end_year");this.end_year=i||(new Date).getFullYear()+9,this.pressed=!1,this.value={minute:[],hour:[],dom:[],month:[],dow:[],year:[]};let r='<article class="crontab_summary"><strong>'+this.translate("summary")+'</strong><p class="summary"></p></article>';if("display"===a)return this.parse(t("code",e).text()),e.append(t(r)),void this.update_summary();let o=this;t('input[type="hidden"]',e).each((function(){o.parse_from_input(t(this))})),e.append(t(r)),this.update_summary(),this.edit_area=t(".editarea",e),this.editarea_cls=this.edit_area.attr("class"),this.edit_area.on("mousedown touchstart",(function(e){o.pressed=!0})),t(document).on("mouseup touchend",(function(e){o.pressed=!1})),t("button.edit",e).on("click",(function(e){e.preventDefault(),o.show_edit_section(t(this))}))}show_edit_section(e){let a,s=this.edit_area,n=this.get_edit_section(e),i=this.get_mode(n);if(s.is(":visible")&&s.hasClass(i))return n.removeClass("active"),void s.attr("class",this.editarea_cls).html("").hide();let r=t("<h4 />"),o=t('<div class="editcontainer" />');if("minute"===i)for(r.text(this.translate("select_minutes")),a=0;a<=59;a++)o.append(this.make_button(a,a,i));else if("hour"===i){let e;for(r.text(this.translate("select_hours")),a=1;a<=24;a++)e=a<24?a:0,o.append(this.make_button(e,e,i))}else if("dom"===i)for(r.text(this.translate("select_dom")),a=1;a<=31;a++)o.append(this.make_button(a,a,i));else if("month"===i){r.text(this.translate("select_month"));let e=this.monthmap();for(a=1;a<=12;a++)o.append(this.make_button(a,e[a],i))}else if("dow"===i){r.text(this.translate("select_dow"));let e,t=this.dowmap();for(a=1;a<=7;a++)e=a<7?a:0,o.append(this.make_button(e,t[e],i))}else if("year"===i)for(r.text(this.translate("select_year")),a=this.start_year;a<=this.end_year;a++)o.append(this.make_button(a,a,i));r=r.add(this.make_button_all(i)),o=r.add(o),s.html(o).attr("class",this.editarea_cls+" "+i).show(),n.addClass("active")}make_button_all(e){let a=t('<button class="btn btn-sm select_all">'+this.translate("select_all")+"</button>");this.value[e].length>=this.maxlengths()[e]&&a.addClass("active");let s=this;return a.on("click",(function(a){a.preventDefault();let n=t(this);n.hasClass("active")?(n.parent().find(".editcontainer button").each((function(){t(this).removeClass("active")})),n.removeClass("active"),s.parse_part("",e)):(n.parent().find(".editcontainer button").each((function(){t(this).removeClass("active").addClass("active")})),n.removeClass("active").addClass("active"),s.parse_part("*",e)),s.serialize_to_input(),s.update_summary()})),a}make_button(e,a,s){let n=t('<button class="btn btn-sm" name='+e+">"+a+"</button>");this.has(e,s)&&n.addClass("active");let i=this,r=function(e){e.preventDefault();let a=t(this),s=i.edit_area;a.hasClass("active")?(i.remove(a.attr("name"),i.get_mode(s)),i.serialize_to_input(),a.removeClass("active")):(i.add(a.attr("name"),i.get_mode(s)),i.serialize_to_input(),a.addClass("active")),i.update_summary()};return n.on("click",(function(e){e.preventDefault()})).on("mousedown touchstart",r).on("mouseenter touchenter",(function(e){!1===e.shiftKey&&!1===i.pressed||r.bind(this)(e)})).on("mouseup touchend",(function(e){i.pressed=!1})),n}maxlengths(){return{minute:60,hour:24,dom:31,month:12,dow:7,year:this.end_year-this.start_year+1}}translate(e){return a[this.lang][e]}monthmap(){return a[this.lang].monthmap}dowmap(){return a[this.lang].dowmap}get_edit_section(e){return e.closest(".cron-value")}get_mode(e){let t=e.attr("class");return-1!==t.indexOf("minute")?"minute":-1!==t.indexOf("hour")?"hour":-1!==t.indexOf("dom")?"dom":-1!==t.indexOf("month")?"month":-1!==t.indexOf("dow")?"dow":-1!==t.indexOf("year")?"year":void 0}add(e,t){this.value[t].push(e.toString())}remove(e,t){let a=this.value[t].indexOf(e.toString());a>-1&&this.value[t].splice(a,1)}has(e,t){return this.value[t].indexOf(e.toString())>-1}parse(e){5===(e=e.split(" ")).length&&e.push("*"),this.parse_part(e[0].trim(),"minute"),this.parse_part(e[1].trim(),"hour"),this.parse_part(e[2].trim(),"dom"),this.parse_part(e[3].trim(),"month"),this.parse_part(e[4].trim(),"dow"),this.parse_part(e[5].trim(),"year")}parse_part(e,t){let a;if("string"==typeof e&&(e=e.split(",")),this.value[t]=[],"*"===e[0]){let e,s;for("minute"===t?(e=0,s=59):"hour"===t?(e=0,s=23):"dom"===t?(e=1,s=31):"month"===t?(e=1,s=12):"dow"===t?(e=0,s=6):"year"===t&&(e=this.start_year,s=this.end_year),a=e;a<s+1;a++)this.value[t].push(a.toString())}else{let s;for(a=0;a<e.length;a++)s=e[a],""!==s&&(s=parseInt(s,10).toString(),this.value[t].push(s))}}serialize(e){let t=this.value[e];t.sort((function(e,t){return parseInt(e,10)-parseInt(t,10)}));let a=this.maxlengths()[e];return t.length>=a?"*":t.join(",")}parse_from_input(e){this.parse_part(e.val(),this.get_mode(this.get_edit_section(e)))}serialize_to_input(){let e=this.edit_area,a=this.get_mode(e);t(".cron-value."+a+" input",this.root).val(this.serialize(a))}group_value(e){let t,a,s=[],n=[];for(t=0;t<e.length;t++)a=t+1,t===e.length-1?(n.push(e[t]),s.push(n)):parseInt(e[t])+1===parseInt(e[a])?n.push(e[t]):(n.push(e[t]),s.push(n),n=[]);return s}update_summary(){t(".crontab_summary .summary",this.root).html(this.summarize())}summarize(){return[this.format_part("minute","no_minutes_selected","selected_minutes","all_minutes_selected"),this.format_part("hour","no_hours_selected","selected_hours","all_hours_selected"),this.format_part("dom","no_dom_selected","selected_dom","all_dom_selected"),this.format_part("month","no_month_selected","selected_month","all_month_selected",this.monthmap()),this.format_part("dow","no_dow_selected","selected_dow","all_dow_selected",this.dowmap()),this.format_part("year","no_year_selected","selected_years","all_years_selected")].join("<br/>")}format_part(e,t,a,s,n){let i,r=this.value[e],o=r.length,l=this.maxlengths()[e];return i=0===o?this.translate(t):o<l?this.translate(a)+this.format_groups(this.group_value(r),n):this.translate(s),i}format_groups(e,t){let a,s,n="";for(a=0;a<e.length;a++)s=e[a],1===s.length?n+=this.display_value(s[0],t):(n+=this.display_value(s[0],t),n+="-",n+=this.display_value(s[s.length-1],t)),a!==e.length-1&&(n+=", ");return n}display_value(e,t){return t?t[e]:e}}function n(e,t){s.initialize(t)}function i(){void 0!==window.yafowil_array&&window.yafowil_array.on_array_event("on_add",n)}return t((function(){void 0!==window.ts?ts.ajax.register(s.initialize,!0):void 0!==window.bdajax?bdajax.register(s.initialize,!0):s.initialize(),i()})),e.CronWidget=s,e.cron_on_array_add=n,e.i18n=a,e.register_array_subscribers=i,Object.defineProperty(e,"__esModule",{value:!0}),window.yafowil=window.yafowil||{},window.yafowil.cron=e,e}({},jQuery);
